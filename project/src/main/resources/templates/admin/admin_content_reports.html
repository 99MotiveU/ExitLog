<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ExitLog - 신고 관리</title>
    <link rel="stylesheet" th:href="@{/css/layoutcss.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/admin.css}" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <body>
    <main>
      <div class="admin-content-title">🚨 신고된 게시글 관리</div>
      <div class="admin-list-container">
        <div class="flex-table-header">
          <div class="col-log-id">글 ID</div>
          <div class="col-log-title">제목</div>
          <div class="col-log-company">회사명</div>
          <div class="col-log-author">작성자</div>
          <div class="col-log-repo-count">신고수</div>
          <div class="col-log-date">작성일</div>
        </div>
        <!-- 게시글 없음 -->
        <th:block th:if="${reportedLogsList == null or #lists.isEmpty(reportedLogsList)}" >
          <div class="flex-table-row">
            <div
              style="
                text-align: center;
                padding: 20px;
                flex-grow: 1;
                color: #6c757d;
              "
            >
              신고된 게시글이 없습니다.
            </div>
          </div>
        </th:block>

        <th:block th:unless="${reportedLogsList == null or #lists.isEmpty(reportedLogsList)}">
          <div class="flex-table-row" th:each="logEntry : ${reportedLogsList}">
            <div class="col-log-id" th:text="${logEntry.logNo}">-</div>
            <div class="col-log-title">
              <span th:text="${logEntry.title}"
                class="report-log-title-action"
                data-toggle="modal" 
                data-target="#reportProcessModal" th:attr="data-logno=${logEntry.logNo}, 
                         data-logtitle=${logEntry.title}, 
                         data-repocount=${logEntry.repoCount}">
              </span>
            </div>
            <div class="col-log-company" th:text="${logEntry.companyName ?: '-'}">-</div>
            <div class="col-log-author" th:text="${logEntry.nickname ?: logEntry.userNo}">-</div>
            <div class="col-log-repo-count" th:text="${logEntry.repoCount}">0</div>
            <div class="col-log-date" th:text="${logEntry.createdDate != null ? #dates.format(logEntry.createdDate, 'yyyy-MM-dd') : '-'}">-</div>
            </div>
        </th:block>
      </div>

      <!-- 페이지네이션 -->
      <nav th:if="${pagination != null && pagination.maxPage > 0}" 
           aria-label="Page navigation" 
           class="d-flex justify-content-center mt-4 admin-pagination">
        <ul class="pagination">
            <li class="page-item" th:classappend="${pagination.currentPage == 1} ? 'disabled' : ''"><a class="page-link" th:href="@{/admin/reports(page=1, limit=${pagination.limit}, pageSize=${pagination.pageSize})}"><i class="fa-solid fa-backward"></i><span class="sr-only">First</span></a></li>
            <li class="page-item" th:classappend="${pagination.currentPage == 1} ? 'disabled' : ''"><a class="page-link" th:href="@{/admin/reports(page=${pagination.prevPage}, limit=${pagination.limit}, pageSize=${pagination.pageSize})}"><i class="fa-solid fa-caret-left"></i><span class="sr-only">Previous</span></a></li>
            <li th:each="pageNum : ${#numbers.sequence(pagination.startPage, pagination.endPage)}" class="page-item" th:classappend="${pageNum == pagination.currentPage} ? 'active' : ''"><a class="page-link" th:href="@{/admin/reports(page=${pageNum}, limit=${pagination.limit}, pageSize=${pagination.pageSize})}" th:text="${pageNum}">1</a></li>
            <li class="page-item" th:classappend="${pagination.currentPage == pagination.maxPage} ? 'disabled' : ''"><a class="page-link" th:href="@{/admin/reports(page=${pagination.nextPage}, limit=${pagination.limit}, pageSize=${pagination.pageSize})}"><i class="fa-solid fa-caret-right"></i><span class="sr-only">Next</span></a></li>
            <li class="page-item" th:classappend="${pagination.currentPage == pagination.maxPage} ? 'disabled' : ''"><a class="page-link" th:href="@{/admin/reports(page=${pagination.maxPage}, limit=${pagination.limit}, pageSize=${pagination.pageSize})}"><i class="fa-solid fa-forward"></i><span class="sr-only">Last</span></a></li>
        </ul>
      </nav>

      <!-- 모달 -->
      <div class="modal fade" id="reportProcessModal" tabindex="-1" aria-labelledby="reportProcessModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable"> <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="reportProcessModalLabel">신고 내역 및 처리 
                <span class="modal-title-log-info">(글 ID: <span id="modalProcessLogId"></span>)</span>
              </h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="currentProcessLogNo" value=""/>
                <div class="d-flex justify-content-start">
                  <div class="p-2 mr-2"><strong>게시글 제목</strong></div>
                  <div class="p-2"><span id="modalProcessLogTitle"></span></div>
                  <div class="p-2"><a href="#" id="modalViewPostLink" target="_blank" class="ml-2 badge badge-success">게시글 내용 보기</a></div>
                </div>
                <div class="d-flex justify-content-start">
                  <div class="p-2 mr-2"><strong>총 신고 횟수</strong></div>
                  <div class="p-2 "><strong id="modalProcessRepoCount" class="text-danger"></strong></div>
                </div>
              <hr>
              <h6><strong>신고 사유 목록</strong></h6>
              <ul id="modalReportReasonList" class="report-reason-list">
                <li class="text-muted">신고 내역을 불러오는 중...</li>
              </ul>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
              <button type="button" class="btn btn-warning" id="processDismissButton">보류</button>
              <button type="button" class="btn btn-danger" id="processDeleteButton">게시글 삭제</button>
            </div>
          </div>
        </div>
      </div>

      <form
        id="deleteLogPostForm"
        method="POST"
        style="display: none"
        th:action="@{/}"
      >
        <input
          type="hidden"
          th:name="${_csrf?.parameterName}"
          th:value="${_csrf?.token}"
        />
      </form>
      <form
        id="dismissReportsPostForm"
        method="POST"
        style="display: none"
        th:action="@{/}"
      >
        <input
          type="hidden"
          th:name="${_csrf?.parameterName}"
          th:value="${_csrf?.token}"
        />
      </form>

      <script th:src="@{/js/admin/report.js}"></script>
    </main>
  </body>
</html>
