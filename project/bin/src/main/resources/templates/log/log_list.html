<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ExitLog</title>

    <!-- log_list 스타일 시트-->
    <link rel="stylesheet" th:href="@{/css/layoutcss.css}" />
    <link rel="stylesheet" th:href="@{/css/log/log_list.css}" />

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Pretendard Font -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>

  <body>
    <!-- header include -->
    <div th:replace="~{layout/header :: header}"></div>

    <main class="container my-5">
      <!-- 검색창 -->
      <div class="d-flex justify-content-center mb-2">
        <form th:action="@{/log}" method="get" class="input-group w-75">
          <div class="input-group-prepend">
            <select class="form-control" name="searchType">
              <option value="title" th:selected="${searchType == 'title'}">
                제목
              </option>
              <option value="author" th:selected="${searchType == 'author'}">
                작성자
              </option>
              <option value="content" th:selected="${searchType == 'content'}">
                제목+내용
              </option>
            </select>
          </div>
          <input
            type="text"
            class="form-control"
            id="search-input"
            name="keyword"
            placeholder="검색어를 입력하세요"
            th:value="${keyword}"
          />
          <input
            type="hidden"
            name="limit"
            th:value="${pagination != null ? pagination.limit : '10'}"
          />
          <input
            type="hidden"
            name="pageSize"
            th:value="${pagination != null ? pagination.pageSize : '10'}"
          />

          <div class="input-group-append">
            <button
              class="btn btn-outline-primary"
              id="search-btn"
              type="submit"
            >
              <i class="fas fa-search"></i>
            </button>
          </div>
        </form>
      </div>

      <!-- 로그 작성 버튼 -->
      <div class="d-flex justify-content-end mb-4">
        <a
          th:if="${session.loginUser != null}"
          th:href="@{/log/write}"
          class="btn btn-primary"
          id="write-log-btn"
          >작성하기</a
        >
      </div>

      <!-- 로그 목록 영역 -->
      <div>
        <!-- 로그 목록 헤더 -->
        <div
          class="log-list-header d-flex flex-column flex-md-row justify-content-between align-items-md-center py-3 border-bottom"
        >
          <div
            class="d-flex flex-column flex-md-row align-items-md-center log-header-main-content"
          >
            <div class="mr-md-5 font-weight-bold small log-header-company">
              회사명
            </div>
            <div class="mr-md-4 font-weight-bold log-header-title">제목</div>
          </div>
          <div
            class="d-flex flex-row align-items-center mt-2 mt-md-0 log-header-meta-content"
          >
            <div class="mr-3 font-weight-bold small log-header-author">
              작성자
            </div>
            <div class="mr-3 font-weight-bold small log-header-date">
              작성일
            </div>
            <div class="font-weight-bold small log-header-views">조회수</div>
          </div>
        </div>

        <!-- 로그 없을 때 -->
        <div
          th:if="${#lists.isEmpty(logListItems)}"
          class="d-flex justify-content-center align-items-center log-pagination"
          style="min-height: 200px"
        >
          <p class="text-muted">게시글이 없습니다.</p>
        </div>

        <!-- 로그 목록 -->
        <a
          th:each="logEntry : ${logListItems}"
          th:href="@{/log/{logNo}(logNo=${logEntry.logNo})}"
          class="text-decoration-none text-reset"
        >
          <div
            class="post-item d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center py-3 border-bottom"
          >
            <div
              class="d-flex flex-column flex-md-row align-items-md-center post-main-content"
            >
              <div
                class="text-muted mr-md-5 font-weight-bold small post-company"
                th:text="${logEntry.companyName ?: '-'}"
              >
                회사명 샘플
              </div>
              <div class="mr-md-4 font-weight-normal post-title-link">
                <span class="text-dark" th:text="${logEntry.title}"
                  >게시글 제목 샘플</span
                >
              </div>
            </div>
            <div
              class="d-flex flex-row align-items-center mt-2 mt-md-0 post-meta-content"
            >
              <div
                class="text-muted mr-3 small post-author"
                th:text="${logEntry.nickname ?: '익명'}"
              >
                작성자 샘플
              </div>
              <div
                class="text-muted mr-3 small post-date"
                th:text="${logEntry.createdDateFormatted ?: '-'}"
              >
                날짜 샘플
              </div>
              <div class="text-muted small post-views">
                <i class="far fa-eye"></i>
                <span th:text="${logEntry.viewCount ?: 0}">0</span>
              </div>
            </div>
          </div>
        </a>
      </div>
      <nav
        th:if="${pagination != null && pagination.maxPage > 0}"
        aria-label="Page navigation"
        class="d-flex justify-content-center mt-4"
      >
        <ul class="pagination">
          <li
            class="page-item"
            th:classappend="${pagination.currentPage == 1} ? 'disabled' : ''"
          >
            <a
              class="page-link"
              th:href="@{/log(page=1, limit=${pagination.limit}, pageSize=${pagination.pageSize}, searchType=${searchType}, keyword=${keyword})}"
            >
              <span>
                <i class="fa-solid fa-backward"></i>
              </span>
              <span class="sr-only">First</span>
            </a>
          </li>

          <li
            class="page-item"
            th:classappend="${pagination.currentPage == 1} ? 'disabled' : ''"
          >
            <a
              class="page-link"
              th:href="@{/log(page=${pagination.prevPage}, limit=${pagination.limit}, pageSize=${pagination.pageSize}, searchType=${searchType}, keyword=${keyword})}"
            >
              <span>
                <i class="fa-solid fa-caret-left"></i>
              </span>
              <span class="sr-only">Previous</span>
            </a>
          </li>

          <li
            th:each="pageNum : ${#numbers.sequence(pagination.startPage, pagination.endPage)}"
            class="page-item"
            th:classappend="${pageNum == pagination.currentPage} ? 'active' : ''"
          >
            <a
              class="page-link"
              th:href="@{/log(page=${pageNum}, limit=${pagination.limit}, pageSize=${pagination.pageSize}, searchType=${searchType}, keyword=${keyword})}"
              th:text="${pageNum}"
              >1</a
            >
          </li>

          <li
            class="page-item"
            th:classappend="${pagination.currentPage == pagination.maxPage} ? 'disabled' : ''"
          >
            <a
              class="page-link"
              th:href="@{/log(page=${pagination.nextPage}, limit=${pagination.limit}, pageSize=${pagination.pageSize}, searchType=${searchType}, keyword=${keyword})}"
            >
              <span><i class="fa-solid fa-caret-right"></i></span>
              <span class="sr-only">Next</span>
            </a>
          </li>

          <li
            class="page-item"
            th:classappend="${pagination.currentPage == pagination.maxPage} ? 'disabled' : ''"
          >
            <a
              class="page-link"
              th:href="@{/log(page=${pagination.maxPage}, limit=${pagination.limit}, pageSize=${pagination.pageSize}, searchType=${searchType}, keyword=${keyword})}"
            >
              <span
                <i class="fa-solid fa-forward"></i>
              </span>
              <span class="sr-only">Last</span>
            </a>
          </li>
        </ul>
      </nav>
    </main>

    <!-- footer include -->
    <div th:replace="~{layout/footer :: footer}"></div>
  </body>
</html>
